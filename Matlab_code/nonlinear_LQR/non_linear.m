function dx=non_linear(t,x)
% syms m1 m2 l1 l2 g M F U

%Variables
m1 = 100;
m2 = 100;
M = 1000;
l1 = 20;
l2 = 10;
g = 9.8;


%Matrices
A = [0 0 0 1 0 0; 0 0 0 0 1 0; 0 0 0 0 0 1; 0 -(m1*g)/M -(m2*g)/M 0 0 0; 0 (-g*(M+m1))/(M*l1) -(m2*g)/(M*l1) 0 0 0; 0 (-m1*g)/(M*l2) -(g*(M+m2))/(M*l2) 0 0 0];
Q = [1 0 0 0 0 0; 0 10 0 0 0 0; 0 0 150 0 0 0; 0 0 0 150 0 0; 0 0 0 0 10 0; 0 0 0 0 0 300];
B = [0; 0; 0; 1/M; 1/(M*l1); 1/(M*l2)];
C = [0 0 0.01 0 0.001 0];
D = 0;
R = 0.0001;

K =lqr(A,B,Q,R);
U=-K*x;

dx=zeros(6,1);
dx(1)= x(4);
dx(2)= x(5);
dx(3)= x(6);
dx(4)=((1/(M+m1+m2-m1*(cos(x(2))^2)-m2*(cos(x(3))^2)))*(U-(m1*l1*sin(x(2))*(x(5)^2))-(m2*l2*sin(x(3))*(x(6)^2))-m1*cos(x(2))*g*sin(x(2))-m2*cos(x(3))*g*sin(x(3))));
dx(5)=(1/l1)*((cos(x(2))*(((1/(M+m1+m2-m1*(cos(x(2))^2)-m2*(cos(x(3))^2)))*(U-(m1*l1*sin(x(2))*(x(5)^2))-(m2*l2*sin(x(3))*(x(6)^2))-m1*cos(x(2))*g*sin(x(2))-m2*cos(x(3))*g*sin(x(3))))))-g*sin(x(2)));
dx(6)=(1/l2)*((cos(x(3))*(((1/(M+m1+m2-m1*(cos(x(2))^2)-m2*(cos(x(3))^2)))*(U-(m1*l1*sin(x(2))*(x(5)^2))-(m2*l2*sin(x(3))*(x(6)^2))-m1*cos(x(2))*g*sin(x(2))-m2*cos(x(3))*g*sin(x(3))))))-g*sin(x(3)));




